<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>참석 여부 투표</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>
<body>

<h2>모임 참석 여부 투표</h2>

<form id="vote-form">

    <!-- 이름 입력 -->
    <label>
        이름: 
        <input type="text" id="username" required />
    </label>
    <br><br>

    <!-- 참석 / 불참 체크 -->
    <label>
        <input type="radio" name="attend" value="참석" required /> 참석
    </label>

    <label>
        <input type="radio" name="attend" value="불참" required /> 불참
    </label>

    <br><br>
    <button type="submit">투표하기</button>

    <div id="status-text" style="margin-top:10px; color:#444;">
        아직 투표 전입니다.
    </div>

</form>

<script>
    const VOTE_API_URL =
      "https://script.google.com/macros/s/AKfycbzOxKKv14jjAajuFpusrA23Niu2ykhbjGG6fcAlfsBqr9-G_0o53Qq8jvnnyIGr19MyYw/exec";

    // 참석 / 불참 데이터를 전송
    async function sendVote(name, attend) {
        const params = new URLSearchParams();
        params.append("name", name);
        params.append("attend", attend);

        return fetch(VOTE_API_URL, {
            method: "POST",
            mode: "no-cors",
            body: params
        });
    }

    document.getElementById("vote-form").addEventListener("submit", async (event) => {
        event.preventDefault();

        const name = document.getElementById("username").value.trim();
        if (!name) {
            alert("이름을 입력해 주세요.");
            return;
        }

        const attend = document.querySelector("input[name='attend']:checked").value;

        const status = document.getElementById("status-text");
        status.textContent = "전송 중입니다...";

        try {
            await sendVote(name, attend);
            status.innerHTML = `<b>${attend}이(가) 저장되었습니다.</b>`;
        } catch (e) {
            console.error(e);
            status.textContent = "오류가 발생했습니다. 다시 시도해 주세요.";
        }
    });
</script>

</body>
</html>
